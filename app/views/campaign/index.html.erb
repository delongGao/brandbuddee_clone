<%= render 'shared/new_header' %>
<link href="/css/social-buttons.css" rel="stylesheet">
<script type="text/javascript" src="//assets.pinterest.com/js/pinit.js"></script>

<% if current_user %>
<% else %>
    <div style="height:70px;"></div>
<% end %>

<div class="container" style="margin-top:105px;">

	<% if flash[:notice].nil? %><% else %>
		<div class="alert alert-info">
		  <button class="close" data-dismiss="alert">×</button>
		  <%= flash[:notice] %>
		</div> <!-- .alert -->
	<% end %>

    <% if flash[:error].nil? %><% else %>
        <div class="alert alert-danger">
          <button class="close" data-dismiss="alert">×</button>
          <%= flash[:error].html_safe %>
        </div> <!-- .alert -->
    <% end %>


    <div class="row">
<!--         <div class="span3">
            
            <div class="well unit-bg">
                <ul class="nav nav-list">
                <% if current_user %>
                    <li><a href="/dashboard"><i class="icon-asterisk"></i>&nbsp;Earn Rewards</a></li>
                    <li><a href="/<%= current_user.nickname %>"><i class="icon-headphones"></i>&nbsp;Your Rewards</a></li>
                    <li><a href="#"><i class="icon-briefcase"></i>&nbsp;Redeem</a></li>
                    <li><a href="#"><i class="icon-tag"></i>&nbsp;Past Rewards</a></li>
                    <li class="divider"></li>
                <% end %>
                    <li><a href="/support/help"><i class="icon-question-sign"></i>&nbsp;Help</a></li>
                </ul>
            </div>

            <div class="well unit-bg">
                <p>
                    <i class="icon-envelope"></i>&nbsp;Invite Friends</p>
                <div class="input-append">
                    <input class="span2" id="inputEmail" type="text" placeholder="Enter your email">
                    <button class="btn" type="button">
                        OK</button>
                </div>
            </div>

        </div> -->

        <div class="span12">
            <div class="row unit-block">
                <div class="span12 unit-bg">
                    <div class="unit">
                        <legend style="margin-bottom:5px;">
                        	<%= @campaign.title %>
                        </legend>
            
            			
                        
                        <div class="row page-content">
                            <div class="span8">

                                <div class="campaign_image_wrap">
                                  <%= image_tag(@campaign.campaign_image_url().to_s, :class=>"campaign_image") %>
                                </div>

                                <br>


                    <% if current_user %>
<!--                         <a href="#" class="btn btn-primary">Share to Facebook</a>
                        <a href="#" class="btn btn-info">Share to Twitter</a>
                        <div class="clear"></div><br>
                        <% @share = Share.where(:campaign_id => @campaign.id, :user_id => current_user.id).first %>
                        <b>Share Link:</b>
                                    <input id="share_link_copy" class="input-large span4" type="text" value="<%#= root_url + 's/' + @share.link %>"> -->

                    

                        <% if current_user.campaigns.where(:_id => @campaign.id).first %>
                            <div id="fb-root"></div>

                                <div id="campaign-share">
                                    <%= javascript_include_tag "http://platform.twitter.com/widgets.js" %>
                                    <div class="sharing-wrap">
                                        <div class="sharing-campaign campaign-twitter-share">
                                            <div id="twitter-button">
                                                <a href="http://twitter.com/share" class="twitter-share-button"
                                                    data-text="<%= @campaign.tweet.html_safe unless @campaign.tweet.nil? %> <%= root_url + 's/' + @share.link %>"
                                                    data-count="none"
                                                    data-url=""
                                                    data-size="">Tweet</a>
                                            </div>
                                        </div>
                                        <div class="sharing-campaign campaign-pinterest-share">
                                            <a href="http://pinterest.com/pin/create/button/?url=<%= root_url + 's/' + @share.link %>&media=<%= @campaign.campaign_image_url() %>&description=<%= @campaign.title %>" class="pin-it-button" target="_blank" count-layout="none"><img border="0" src="//assets.pinterest.com/images/PinExt.png" title="Pin It" /></a>
                                        </div>
                                        <div class="sharing-campaign campaign-facebook-share">
                                            <div class="fb-like" data-href="<%= root_url + 's/' + @share.link %>" data-send="true" data-width="375" data-show-faces="false" data-action=""></div>
                                        </div>
                                        
                                    </div>
                                    <div class="clear"></div>
                                    Share Link:
                                    <input id="share_link_copy" class="input-large span4" type="text" value="<%= root_url + 's/' + @share.link %>">
                                    <a href="#facebookModal" class="btn btn-primary btn-large" data-toggle="modal" style="margin-bottom:8px;"><i class="icon-circle-arrow-up icon-white"></i> Post to Facebook</a>
                                    <div class="clear"></div>
                                </div><br>


                                <!-- Facebook Modal -->
                                <div id="facebookModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                                  <div class="modal-header">
                                    <button class="close" data-dismiss="modal">×</button>
                                    <h3>Post to Facebook</h3>
                                  </div>
                                  <div class="modal-body">
                                    <%= form_tag url_for(:controller => 'campaign', :action => 'facebook_wall_post'), :id => "", :class => "form-horizontal" do %>

                                        <%= text_area_tag :personal_message, nil, :class => "input-large facebook_wall_post", :placeholder=>"your personal message...", :rows => 3 %>
                                        <%= hidden_field_tag(:name, @campaign.title) %>
                                        <%= hidden_field_tag(:caption, @campaign.reward) %>
                                        <%= hidden_field_tag(:description, @campaign.detail) %>
                                        <%= hidden_field_tag(:campaign_link, @campaign.link) %>
                                        <% if Rails.env.development? %>
                                            <%= hidden_field_tag(:link, 'http://brandbuddee.com/s/OEt4nXwnhnR') %>
                                            <%= hidden_field_tag(:picture, 'http://brandbuddee.s3.amazonaws.com/campaign_image/50a30cb13facd1000200000b/standard_Screen_Shot_2012-11-13_at_7.46.54_PM.png') %>
                                        <% elsif Rails.env.production? %>
                                            <% unless @share.link.nil? %>
                                            <%= hidden_field_tag(:link, root_url + 's/' + @share.link) %>
                                            <% end %>
                                            <%= hidden_field_tag(:picture, @campaign.campaign_image_url(:standard).to_s) %>
                                        <% end %>
                                  </div>
                                  <div class="modal-footer">
                                    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
                                        <%= submit_tag 'Post', :class=>"btn btn-primary" %>
                                    <% end %>
                                  </div>
                                </div>


                        <% end %>

                    <% end %>


                    <div class="well">
                        <h4>What do I get?</h4>
                        <p><%= @campaign.reward unless @campaign.reward.nil? %></p>
                    </div> <!-- .well -->

                    <p><%= @campaign.detail %></p>


                    
								<br>

<!--                                 <h4>Location</h4>
                                <iframe width="100%" height="250" frameborder="0" scrolling="no" marginheight="0"
                                    marginwidth="0" src="https://maps.google.com/maps?f=q&amp;source=embed&amp;hl=en&amp;geocode=&amp;q=Seattle,+WA,+United+States&amp;aq=0&amp;sll=37.0625,-95.677068&amp;sspn=49.043149,74.443359&amp;ie=UTF8&amp;hq=&amp;hnear=Seattle,+Washington&amp;spn=0.00301,0.004544&amp;t=m&amp;z=14">
                                </iframe>
                                <br>
                                <a href="http://maps.google.com/maps?f=q&amp;source=embed&amp;hl=en&amp;geocode=&amp;q=Seattle,+WA,+United+States&amp;aq=0&amp;oq=twitter+san+fra&amp;sll=37.0625,-95.677068&amp;sspn=49.043149,74.443359&amp;ie=UTF8&amp;hq=&amp;hnear=Twitter+Bldg,+Market+St,+Seattle,+WA+94103&amp;ll=37.776606,-122.416728&amp;spn=0.00301,0.004544&amp;t=m&amp;z=14"
                                    target="_blank">View Larger Map</a><br /> -->


                                <div class="">
                                    <h4>How to Redeem</h4>
                                    <p><%= @campaign.redeem_details %></p>
                                    
                                    <br><br><br>
                                </div> <!-- .well -->



                            </div>
                            <div class="span4">

                                <div class="well text-center">
                                    <ul class="unstyled">
                                        <li><span class="text-highlight-large"><b><%= @campaign.points_required %></b></span> pts</li>
                                        <li>&nbsp;</li>

<% left = @campaign.limit - @campaign.redeems.size %>
<% if current_user %>
			<% if current_user.campaigns.where(:_id => @campaign.id).first %>
                <% @official_pts = @share.unique_page_views + @share.trackings.size %>
				<p>Your Points: <b style="font-size:17px;"><%= @official_pts %></b></p>

                <% unless left == 0 %>
                	<p><span class="label label-success activated_label">Activated!</span></p>
                <% end %>

				<% if left == 0 || @campaign.end_date < Time.now %>
					<div class="alert alert-info">
						This campaign has finished.
					</div> <!-- .alert -->
				<% end %>

				<% unless @share.unique_page_views.nil? %>
					<% if @official_pts >= @campaign.points_required %>
                        <% if @redeem.nil? %>
                            <div class="alert alert-info">
                                This campaign has finished.
                            </div> <!-- .alert -->
                        <% else %>
    						<p><a href="#" class="btn btn-large btn-success redeem_button">Redeem</a></p>
    						<% @redeem = @campaign.redeems.where(:user_id => current_user.id).first %>
    						<h5 class="redeem_code alert alert-success"><%= @redeem.redeem_code unless @redeem.redeem_code.nil? %></h5>

                             <script>
                                $('.activated_label').hide();
                            </script>
                        <% end %>
					<% end %>
				<% end %>
				

			<% elsif %>

				<% if left == 0 || @campaign.end_date < Time.now %>
					<div class="alert alert-info">
						This campaign has finished.
					</div> <!-- .alert -->
				<% elsif %>
					
					<li>
	                    <%= link_to "Join", { :controller=>'campaign', :action=>'activate_campaign', :_c => @campaign.id }, :class=>"btn btn-large btn-info" %>

	                </li>
				<% end %>
			<% end %>
		<% end %>
                                        
                                        <li>&nbsp;</li>
                                        <li>
                                            <table class="table">
                                                <tr class="firstrow">
                                                    <td>
                                                        Available
                                                    </td>
                                                    <td>
                                                        
                                                        <% if left == 0 || @campaign.end_date < Time.now %>
                                                            0
                                                        <% else %>
                                                            <%= @campaign.limit - @campaign.redeems.size %>
                                                        <% end %>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        Remaining
                                                    </td>
                                                    <td>
                                                        <% if left == 0 || @campaign.end_date < Time.now %>
                                                            0
                                                        <% else %>
                                                            <%= time_ago_in_words(@campaign.end_date) + ' left' unless @campaign.end_date.nil? %>
                                                        <% end %>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        Brand
                                                    </td>
                                                    <td>
                                                        <%= @campaign.brand.name %>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        Category
                                                    </td>
                                                    <td>
                                                        <% @campaign.categories.each do |c| %>
															<span class="label label-info"><%= c.name %></span>
														<% end %>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        Location
                                                    </td>
                                                    <td>
                                                        <%= @campaign.location.city + ', ' + @campaign.location.state %>
                                                    </td>
                                                </tr>
                                            </table>
                                        </li>
                                    </ul>
                                </div>


                                <div class="well">
                                    <h4>About <%= @campaign.brand.name %></h4>
                                    <p><%= @campaign.brand.bio %></p>
                                    <% unless @campaign.brand.website.blank? || @campaign.brand.website.nil? %>
    									<p><a href="<%= @campaign.brand.website %>" target="_blank" class="campaign_brand_link">Website</a></p>
                                    <% end %>
                                    <% unless @campaign.brand.facebook.blank? || @campaign.brand.facebook.nil? %>
                                        <a href="<%= @campaign.brand.facebook %>" target="_blank" class="sb circle facebook mytooltip" data-original-title="Facebook">Facebook</a>
                                    <% end %>
                                    <% unless @campaign.brand.twitter.blank? || @campaign.brand.twitter.nil? %>
                                        <a href="<%= @campaign.brand.twitter %>" target="_blank" class="sb circle twitter mytooltip" data-original-title="Twitter">Twitter</a>
                                    <% end %>
									<% unless @campaign.brand.pinterest.blank? || @campaign.brand.pinterest.nil? %>
                                        <a href="<%= @campaign.brand.pinterest %>" target="_blank" class="sb circle pinterest mytooltip" data-original-title="Pinterest">Pinterest</a>
                                    <% end %>
                                    <% unless @campaign.brand.gplus.blank? || @campaign.brand.pinterest.nil? %>
                                        <a href="<%= @campaign.brand.gplus %>" target="_blank" class="sb circle gplus mytooltip" data-original-title="Google Plus">Google Plus</a>
                                    <% end %>
                                    <p>
                            
                            
                            
                            
                        </p>
                                </div> <!-- .well -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="span9">
                    <ul class="thumbnails">
                        <% @campaigns_else.each do |c| %>
                          <li class="span3">
                            <div class="thumbnail unit-bg" style="height:342px;">
                                  <a href="/campaign/<%= c.link %>">
                                      <%= image_tag(c.campaign_image_url(:standard).to_s, :width=>"100%") %>
                                  </a>
                                  <div class="caption">
                                      <h4 class="campaign_profile_title_wrap">
                                          <%= truncate(c.title, :length => 37, :omission => '...') %>
                                      </h4>
                                      <p class="campaign_profile_reward_wrap">
                                          <%= truncate(c.reward, :length => 54, :omission => '...') %></p>
                                      <p class="pull-right" style="margin:0;">
                                          <span class="help-block"><small><i class="icon-tag"></i>&nbsp;<%= c.limit - c.redeems.size %> Available&nbsp;&nbsp;<i
                                              class="icon-time"> </i>&nbsp;

                                              <% unless c.end_date.nil? %>
                                                    <% if c.end_date > Time.now %>
                                                        <%= time_ago_in_words(c.end_date) + ' left' %>
                                                    <% else %>
                                                        Campaign ended
                                                    <% end %>
                                                <% end %>

                                            </small></span>
                                      </p>
                                      <div class="clear"></div>

                                      <span class="campaign_details" style="margin:0;">
                                        <span class="pts_req_wrap">
                                            <span class="help-inline text-highlight-small pts_req">
                                                <%= c.points_required %>
                                            </span>
                                            <span class="pts_req_text">pts</span>
                                        </span> <!-- .pts_req_wrap -->
                                        <span class="view-deal">
                                            <a href="/campaign/<%= c.link %>" class="btn btn-success">View&nbsp;<i class="icon-chevron-right icon-white"></i></a>
                                        </span> <!-- .view-deal -->
                                      </span> <!-- .campaign_details -->
                                  </div>
                              </div>
                          </li>
                        <% end %>
                    </ul>
                </div>
            </div>
            

            <br><br><br>
            <%= render "shared/new_footer" %>

        </div>
    </div>
</div>





    <script>        
    !function (d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (!d.getElementById(id)) {
                js = d.createElement(s); js.id = id; js.src = "//platform.twitter.com/widgets.js";
                fjs.parentNode.insertBefore(js, fjs);
            }
        } (document, "script", "twitter-wjs"); </script>
    <!-- facebook -->
    <div id="fb-root">
    </div>
    <script>        (function (d, s, id) {
            var 
    js, fjs = d.getElementsByTagName(s)[0]; if (d.getElementById(id)) return; js = d.createElement(s);
            js.id = id; js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=524356277579122";
            fjs.parentNode.insertBefore(js, fjs);
        } (document, 'script', 'facebook-jssdk'));
    </script>

    <script>
        window.onload = function()
        {
            if(window.jQuery)
            {
                $(document).ready(function(){
                    $('.mytooltip').tooltip({'placement':'top', 'trigger' : 'hover'});
                });
            }
        }
    </script>


    <!-- backstretch -->
    <!--<script src="/js/jquery.backstretch.min.js"></script>
    <script>
      $.backstretch("/assets/bg.jpg");
    </script>-->
