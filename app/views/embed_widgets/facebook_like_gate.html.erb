<% content_for :facebook_init_permissions do %>
<div id="fb-root"></div>
<script>
window.fbAsyncInit = function() {
	// init the FB JS SDK
	FB.init({
		appId      : <% if Rails.env.development? %>'253857021420655'<% elsif Rails.env.production? %>'278238152312772'<% end %>, // App ID from the App Dashboard
		channelUrl : '//www.applecrateseo.com/facebooksample/channel.php', // Channel File for x-domain communication
		status     : true, // check the login status upon init?
		cookie     : true, // set sessions cookies to allow your server to access the session?
		frictionlessRequests : true, // enable frictionless requests
		xfbml      : true  // parse XFBML tags on this page?
	}); // FB.init()

  	// Additional initialization code such as adding Event Listeners goes here
  
  	// Next, find out if the user is logged in
  	FB.getLoginStatus(function(response) {
    	if (response.status === 'connected') {
      		var uid = response.authResponse.userID;
      		var accessToken = response.authResponse.accessToken;
      		FB.api('/me', function(info) {
        		console.log(info);
      		});      
    	} else if (response.status === 'not_authorized') {
      		// the user is logged in to Facebook, but has not authenticated your app
      		var oauth_url = 'https://www.facebook.com/dialog/oauth/';
      		oauth_url += '?client_id=<% if Rails.env.development? %>253857021420655<% elsif Rails.env.production? %>278238152312772<% end %>'; // Your client id
      		oauth_url += '&redirect_uri=' + 'https://apps.facebook.com/index.php'; // Send them here if they're not logged in
      		oauth_url += '&scope=email,offline_access,publish_actions,publish_stream,user_birthday,user_about_me,user_location,user_likes,user_education_history,user_website,read_friendlists,user_interests,user_hometown,user_status,manage_pages';
      		window.top.location = oauth_url;
    	} else {
      		// the user isn't logged in to Facebook.
      		window.top.location = 'https://www.facebook.com/index.php';
    	} // End else
  	}); // getLoginStatus
}; // fbAsyncInit

// Load the SDK's source Asynchronously
// Note that the debug version is being actively developed and might 
// contain some type checks that are overly strict. 
// Please report such bugs using the bugs tool.
(function(d, debug){
	var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
  	if (d.getElementById(id)) {return;}
  	js = d.createElement('script'); js.id = id; js.async = true;
  	js.src = "//connect.facebook.net/en_US/all" + (debug ? "/debug" : "") + ".js";
  	ref.parentNode.insertBefore(js, ref);
}(document, /*debug*/ false));
</script>
<% end %>
<div class="container">
	<div class="row">
		<% if @continue == true %>
			<% if (!@result.nil? && @result["page"]["admin"] == true) || params[:admin] == "true" %>
				<a href="/fb-embed-admin<%= "?page_id=#{@page_id}&liked=#{@liked}&admin=#{@admin}" %>" class="btn btn-info" style="font-weight:700;margin-bottom:1%;"><i class="icon-share-alt"></i> Continue to Embed Widget</a>
			<% end %>
				<%= image_tag "likegate.png", size: "800x400", alt: "brandbuddee-seattle-rewards", title: "brandbuddee Seattle Rewards" %>
		<% else %>
			<div class="span8 offset2">
				<div class="well well-large text-center" id="fb-embed-index">
					<h2><%= @error %></h2>
				</div>
			</div>
		<% end %>
	</div>
</div>
